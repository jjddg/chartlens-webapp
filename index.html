<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChartLens - Crypto Chart AI Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0f1c 0%, #0f1419 100%);
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }

        :root {
            --color-primary: #2dd4bf;
            --color-secondary: #0f172a;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --color-text: #ffffff;
            --color-text-muted: #9ca3af;
            --color-border: #374151;
            --color-card: #1f2937;
            --color-accent: #06b6d4;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #0a0f1c 0%, #1f2937 100%);
            padding: 1.5rem;
            border-bottom: 2px solid var(--color-primary);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(45, 212, 191, 0.1);
        }

        .header-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, #2dd4bf 0%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .btn-icon {
            background: rgba(45, 212, 191, 0.1);
            border: 2px solid var(--color-primary);
            color: var(--color-text);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .btn-icon:hover {
            background: rgba(45, 212, 191, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(45, 212, 191, 0.3);
        }

        /* Container */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1.5rem;
            min-height: calc(100vh - 300px);
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        .section.hidden {
            display: none !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards */
        .card {
            background: linear-gradient(135deg, var(--color-card) 0%, rgba(31, 41, 55, 0.5) 100%);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--color-primary), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover {
            border-color: var(--color-primary);
            box-shadow: 0 12px 32px rgba(45, 212, 191, 0.2), inset 0 0 20px rgba(45, 212, 191, 0.05);
            transform: translateY(-2px);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card h2,
        .card h3,
        .card h4 {
            margin-bottom: 1rem;
            color: var(--color-primary);
            font-weight: 600;
        }

        .card p {
            color: var(--color-text-muted);
            margin-bottom: 1rem;
            line-height: 1.8;
        }

        /* Auth Card */
        .auth-card {
            text-align: center;
            padding: 3rem 1.5rem;
        }

        .auth-card h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .auth-card .emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--color-text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.75rem;
        }

        .form-input,
        select {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid var(--color-border);
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.8);
            color: var(--color-text);
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-input::placeholder {
            color: var(--color-text-muted);
        }

        .form-input:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
            background: rgba(15, 23, 42, 1);
            box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.2);
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232dd4bf' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.875rem center;
            background-size: 16px;
            padding-right: 2.5rem;
        }

        /* Buttons */
        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2dd4bf 0%, #06b6d4 100%);
            color: #0a0f1c;
            box-shadow: 0 8px 16px rgba(45, 212, 191, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(45, 212, 191, 0.4);
        }

        .btn-secondary {
            background: rgba(45, 212, 191, 0.1);
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(45, 212, 191, 0.2);
            transform: translateY(-2px);
        }

        .btn-full {
            width: 100%;
            margin-top: 1rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* User Info */
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.1) 0%, rgba(6, 182, 212, 0.05) 100%);
            border: 2px solid var(--color-primary);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .user-info h3 {
            color: var(--color-primary);
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .badge {
            display: inline-block;
            background: rgba(45, 212, 191, 0.2);
            color: var(--color-primary);
            padding: 0.35rem 0.85rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.5rem;
        }

        .quota {
            text-align: right;
        }

        .quota small {
            color: var(--color-text-muted);
            font-size: 0.85rem;
        }

        /* Signal Badge */
        .signal-badge {
            text-align: center;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: rgba(45, 212, 191, 0.1);
            border-radius: 12px;
            border: 2px solid var(--color-primary);
        }

        .signal {
            display: inline-block;
            padding: 0.875rem 2rem;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.5rem;
            letter-spacing: 1px;
            min-width: 150px;
        }

        .signal.buy {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
        }

        .signal.sell {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 8px 16px rgba(239, 68, 68, 0.3);
        }

        .signal.hold {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 8px 16px rgba(245, 158, 11, 0.3);
        }

        /* Result Sections */
        .result-section {
            margin: 1.5rem 0;
            padding: 1.25rem;
            background: rgba(45, 212, 191, 0.08);
            border-left: 4px solid var(--color-primary);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .result-section:hover {
            background: rgba(45, 212, 191, 0.12);
            border-left-width: 6px;
        }

        .result-section h4 {
            color: var(--color-primary);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-text {
            color: var(--color-text);
            line-height: 1.8;
            font-size: 0.95rem;
        }

        .confidence {
            text-align: center;
            padding: 1.25rem;
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.15), rgba(6, 182, 212, 0.1));
            border-radius: 10px;
            margin: 1.5rem 0;
            border: 2px solid var(--color-primary);
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: rgba(45, 212, 191, 0.2);
            border-radius: 4px;
            margin-top: 0.75rem;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #2dd4bf 0%, #06b6d4 100%);
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        /* Error Card */
        .error-card {
            border: 2px solid var(--color-danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .error-card h4 {
            color: var(--color-danger);
        }

        .error-card p {
            color: var(--color-text);
        }

        /* History List */
        .history-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .history-item {
            padding: 1rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .history-item:hover {
            background: rgba(45, 212, 191, 0.1);
            border-color: var(--color-primary);
            border-left: 4px solid var(--color-primary);
            transform: translateX(4px);
        }

        .history-symbol {
            font-weight: 700;
            color: var(--color-primary);
            font-size: 1.1rem;
            font-family: 'Courier New', monospace;
        }

        .history-date {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-top: 0.25rem;
        }

        .history-signal {
            padding: 0.35rem 0.85rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            min-width: 60px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .history-signal.buy {
            background: rgba(16, 185, 129, 0.2);
            color: var(--color-success);
        }

        .history-signal.sell {
            background: rgba(239, 68, 68, 0.2);
            color: var(--color-danger);
        }

        .history-signal.hold {
            background: rgba(245, 158, 11, 0.2);
            color: var(--color-warning);
        }

        /* Premium Card */
        .premium-card {
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.15) 0%, rgba(6, 182, 212, 0.1) 100%);
            border: 2px solid var(--color-primary);
        }

        .plan-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.25rem;
            margin-top: 1.5rem;
        }

        .plan {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.6), rgba(31, 41, 55, 0.6));
            border: 2px solid var(--color-border);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .plan:hover {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(31, 41, 55, 0.8));
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(45, 212, 191, 0.2);
        }

        .plan h4 {
            color: var(--color-primary);
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .plan .price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 1rem;
            font-family: 'Courier New', monospace;
        }

        .plan ul {
            list-style: none;
            margin-bottom: 1.25rem;
            font-size: 0.8rem;
        }

        .plan li {
            padding: 0.35rem 0;
            color: var(--color-text-muted);
        }

        .plan .btn {
            width: 100%;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid var(--color-border);
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 1rem;
        }

        .nav-tab {
            padding: 0.75rem 1.25rem;
            border: 2px solid transparent;
            border-radius: 10px;
            background: rgba(45, 212, 191, 0.05);
            color: var(--color-text-muted);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--color-primary);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .nav-tab:hover {
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .nav-tab.active {
            color: var(--color-primary);
            border-color: var(--color-primary);
            background: rgba(45, 212, 191, 0.1);
        }

        .nav-tab.active::before {
            transform: scaleX(1);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.1) 0%, rgba(6, 182, 212, 0.05) 100%);
            border: 2px solid var(--color-primary);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(45, 212, 191, 0.2);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-primary);
            font-family: 'Courier New', monospace;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Referral Box */
        .referral-box {
            background: linear-gradient(135deg, rgba(45, 212, 191, 0.15), rgba(6, 182, 212, 0.1));
            border: 2px dashed var(--color-primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .referral-code {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-weight: 700;
            color: var(--color-primary);
            word-break: break-all;
            transition: all 0.3s;
        }

        .referral-code:hover {
            background: rgba(45, 212, 191, 0.1);
            box-shadow: 0 0 20px rgba(45, 212, 191, 0.3);
        }

        /* Copy Button */
        .copy-btn {
            background: rgba(45, 212, 191, 0.2);
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 0.5rem;
        }

        .copy-btn:hover {
            background: rgba(45, 212, 191, 0.3);
            transform: scale(1.05);
        }

        .copy-btn.copied {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--color-success);
            color: var(--color-success);
        }

        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .loading.hidden {
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(45, 212, 191, 0.2);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading p {
            margin-top: 1.5rem;
            color: var(--color-text-muted);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 1rem;
            border-top: 2px solid var(--color-border);
            color: var(--color-text-muted);
            font-size: 0.85rem;
            margin-top: 3rem;
        }

        /* Utilities */
        .hidden {
            display: none !important;
        }

        .text-muted {
            color: var(--color-text-muted);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .card {
                padding: 1.25rem;
            }

            .plan-grid {
                grid-template-columns: 1fr;
            }

            .user-info {
                flex-direction: column;
            }

            .quota {
                text-align: left;
                margin-top: 1rem;
            }

            .signal {
                min-width: auto;
            }

            .nav-tabs {
                gap: 0.25rem;
            }

            .nav-tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    

/* ===== WOW HERO (AI VISION) ===== */

:root {
  --bg: #05070c;
  --panel: rgba(255,255,255,0.06);
  --glass: rgba(255,255,255,0.08);
  --border: rgba(255,255,255,0.12);
  --ai: #22f3b6;
  --accent: #36e0ff;
  --text: #e8f0ff;
  --muted: #9aa4bf;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Space Grotesk', sans-serif;
  background: radial-gradient(1200px 600px at 70% -10%, #0e162f 0%, var(--bg) 50%);
  color: var(--text);
  overflow-x: hidden;
}

/* ===== HERO ===== */
.hero {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 4rem 2rem;
  position: relative;
}

.hero-inner {
  max-width: 1200px;
  width: 100%;
  display: grid;
  grid-template-columns: 1.1fr 0.9fr;
  gap: 4rem;
  align-items: center;
}

.hero-text h1 {
  font-size: clamp(2.5rem, 5vw, 4rem);
  line-height: 1.05;
  margin: 0 0 1.5rem;
}

.hero-text h1 span {
  color: var(--ai);
}

.hero-text p {
  font-size: 1.1rem;
  color: var(--muted);
  max-width: 520px;
}

.hero-actions {
  margin-top: 2.5rem;
}

.btn {
  padding: 0.9rem 1.6rem;
  border-radius: 12px;
  font-weight: 600;
  font-size: 0.95rem;
  border: 1px solid var(--border);
  cursor: pointer;
  transition: all .3s ease;
}

.btn-primary {
  background: linear-gradient(135deg, var(--ai), var(--accent));
  color: #000;
  border: none;
  box-shadow: 0 0 40px rgba(34,243,182,0.35);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 60px rgba(34,243,182,0.55);
}

/* ===== GRAPH ===== */
.graph-wrap {
  perspective: 1200px;
}

.graph {
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 1.5rem;
  transform-style: preserve-3d;
  transition: transform .1s ease-out;
  box-shadow: 0 40px 120px rgba(0,0,0,0.6);
}

.graph svg {
  width: 100%;
  height: 260px;
}

.ai-tag {
  position: absolute;
  background: var(--glass);
  border: 1px solid var(--border);
  backdrop-filter: blur(12px);
  padding: 0.5rem 0.7rem;
  border-radius: 10px;
  font-size: 0.75rem;
  box-shadow: 0 0 20px rgba(34,243,182,0.35);
}

.ai-tag strong {
  color: var(--ai);
}

.tag1 { top: 20%; left: 10%; }
.tag2 { top: 50%; right: 12%; }
.tag3 { bottom: 18%; left: 35%; }

/* ===== SECTIONS ===== */
.section {
  padding: 6rem 2rem;
}

.section h2 {
  font-size: clamp(2rem, 4vw, 3rem);
  text-align: center;
  margin-bottom: 3rem;
}

.steps {
  max-width: 1100px;
  margin: auto;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 2rem;
}

.step {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 2rem;
  text-align: center;
}

.step h3 {
  margin-top: 1rem;
  color: var(--ai);
}

/* ===== PRICING ===== */
.pricing {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px,1fr));
  gap: 2rem;
  max-width: 1000px;
  margin: auto;
}

.plan {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 2.5rem 2rem;
  text-align: center;
}

.plan h3 {
  margin-bottom: 0.5rem;
}

.plan .price {
  font-size: 2rem;
  margin: 1rem 0;
  color: var(--ai);
}

.plan ul {
  list-style: none;
  padding: 0;
  color: var(--muted);
  font-size: 0.9rem;
}

.plan ul li {
  margin: 0.5rem 0;
}

/* ===== CTA ===== */
.cta {
  text-align: center;
}

footer {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--muted);
  font-size: 0.8rem;
}

/* Keep WOW hero inside v4 container */
.wow-auth-wrap { margin: -1.5rem; } /* align with container padding */
.wow-auth-wrap .hero { min-height: calc(100vh - 110px); } /* account for sticky header */
.wow-auth-wrap .hero-inner { max-width: 1100px; margin: 0 auto; }

/* Ensure WOW graph id exists for tilt */
.wow-auth-wrap .graph { position: relative; }

/* Make v4 auth section padding consistent */
#authSection { display:block; }

/* Optional: hide logout before auth */
body:not(.authed) .btn-icon { opacity: 0.35; pointer-events: none; }




/* =========================================================
   VISION THEME OVERRIDES ‚Äî make v4 app look like WOW lab
   ========================================================= */

:root{
  /* Map v4 tokens to WOW tokens */
  --color-primary: var(--ai);
  --color-accent: var(--accent);
  --color-bg: var(--bg);
  --color-card: rgba(255,255,255,0.06);
  --color-border: rgba(255,255,255,0.12);
  --color-text: var(--text);
  --color-text-muted: var(--muted);
  --color-success: #22f3b6;
  --color-danger: #ff3b5c;
}

body{
  font-family: 'Space Grotesk', sans-serif;
  background: radial-gradient(1200px 600px at 70% -10%, #0e162f 0%, var(--bg) 50%);
  color: var(--text);
  overflow-x:hidden;
}

body::before{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events:none;
  background:
    radial-gradient(800px 400px at 15% 10%, rgba(34,243,182,0.08), transparent 60%),
    radial-gradient(900px 500px at 85% 20%, rgba(54,224,255,0.07), transparent 60%),
    linear-gradient(transparent 0%, rgba(0,0,0,0.10) 100%);
  mix-blend-mode: screen;
  opacity: 1;
  z-index: 0;
}

.container{
  position: relative;
  z-index: 1;
  max-width: 1100px;
  padding: 1.75rem;
  min-height: unset;
}

/* Make sections feel like panels, not "pages" */
.section{
  animation: fadeIn 0.45s ease-in;
}

/* Nav tabs as a glass control bar */
.nav-tabs{
  border-bottom: none !important;
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--color-border);
  border-radius: 18px;
  padding: 0.55rem;
  gap: 0.6rem;
  backdrop-filter: blur(14px);
  box-shadow: 0 22px 70px rgba(0,0,0,0.35);
  margin-bottom: 1.75rem;
}

.nav-tab{
  background: transparent !important;
  border-radius: 14px;
  border: 1px solid transparent !important;
  color: var(--color-text-muted) !important;
  transition: transform .2s ease, background .2s ease, box-shadow .2s ease, color .2s ease;
}

.nav-tab:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,0.05) !important;
  color: var(--color-text) !important;
}

.nav-tab.active{
  background: linear-gradient(135deg, var(--ai), var(--accent)) !important;
  color: #000 !important;
  box-shadow: 0 0 30px rgba(34,243,182,0.35);
}

/* Cards become glass modules */
.card{
  background: rgba(255,255,255,0.06) !important;
  border: 1px solid rgba(255,255,255,0.12) !important;
  border-radius: 20px !important;
  backdrop-filter: blur(14px);
  box-shadow: 0 24px 90px rgba(0,0,0,0.40);
}

.card:hover{
  box-shadow: 0 30px 120px rgba(0,0,0,0.55);
  transform: translateY(-1px);
}

.user-info{
  background: rgba(255,255,255,0.04) !important;
  border: 1px solid rgba(255,255,255,0.10) !important;
  backdrop-filter: blur(14px);
}

/* Inputs */
.form-input, select{
  background: rgba(255,255,255,0.04) !important;
  border: 1px solid rgba(255,255,255,0.12) !important;
  color: var(--text) !important;
  border-radius: 14px !important;
}

.form-input:focus, select:focus{
  outline: none !important;
  border-color: rgba(34,243,182,0.85) !important;
  box-shadow: 0 0 0 4px rgba(34,243,182,0.12), 0 0 28px rgba(34,243,182,0.10);
}

/* Buttons */
.btn{
  border-radius: 14px !important;
  font-weight: 700 !important;
  letter-spacing: 0.2px;
}

.btn-primary{
  background: linear-gradient(135deg, var(--ai), var(--accent)) !important;
  color: #000 !important;
  border: none !important;
  box-shadow: 0 0 40px rgba(34,243,182,0.35) !important;
}

.btn-primary:hover{
  transform: translateY(-2px);
  box-shadow: 0 0 70px rgba(34,243,182,0.55) !important;
}

.btn-secondary{
  background: rgba(255,255,255,0.06) !important;
  color: var(--text) !important;
  border: 1px solid rgba(255,255,255,0.14) !important;
}

.btn-secondary:hover{
  background: rgba(255,255,255,0.10) !important;
}

/* Badge */
.badge{
  background: rgba(34,243,182,0.10) !important;
  border: 1px solid rgba(34,243,182,0.28) !important;
  color: var(--ai) !important;
  font-weight: 800 !important;
}

/* Signal look */
.signal-badge{
  background: rgba(255,255,255,0.04) !important;
  border: 1px solid rgba(255,255,255,0.14) !important;
  box-shadow: inset 0 0 0 1px rgba(34,243,182,0.06), 0 0 40px rgba(0,0,0,0.35);
}

.signal.buy{
  background: linear-gradient(135deg, var(--ai), var(--accent)) !important;
  color: #000 !important;
  box-shadow: 0 0 40px rgba(34,243,182,0.35) !important;
}
.signal.sell{
  background: linear-gradient(135deg, #ff3b5c, #ff8a3b) !important;
  color: #0b0f1c !important;
  box-shadow: 0 0 40px rgba(255,59,92,0.25) !important;
}
.signal.hold{
  background: linear-gradient(135deg, #9aa4bf, #e8f0ff) !important;
  color: #0b0f1c !important;
  box-shadow: 0 0 40px rgba(232,240,255,0.14) !important;
}

/* Confidence bar */
.confidence-bar{
  background: rgba(255,255,255,0.06) !important;
  border: 1px solid rgba(255,255,255,0.12) !important;
  border-radius: 999px !important;
  overflow: hidden;
}
.confidence-fill{
  background: linear-gradient(135deg, var(--ai), var(--accent)) !important;
  box-shadow: 0 0 24px rgba(34,243,182,0.25);
}

/* Result text */
.result-text{
  color: rgba(232,240,255,0.86) !important;
}

/* ===== Scan overlay FX ===== */
.scan-overlay{
  position: fixed;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  transform: translateZ(0);
  transition: opacity .2s ease;
  z-index: 999;
}

.scan-overlay.active{
  opacity: 1;
}

.scan-noise{
  position:absolute;
  inset:0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
  opacity: .08;
  mix-blend-mode: overlay;
}

.scan-grid{
  position:absolute;
  inset:0;
  background:
    linear-gradient(rgba(34,243,182,0.06) 1px, transparent 1px),
    linear-gradient(90deg, rgba(34,243,182,0.06) 1px, transparent 1px);
  background-size: 48px 48px;
  mask-image: radial-gradient(600px 400px at 50% 40%, black 0%, transparent 70%);
  opacity: .9;
}

.scan-line{
  position:absolute;
  left:0;
  right:0;
  height: 2px;
  top: 20%;
  background: linear-gradient(90deg, transparent, rgba(34,243,182,0.9), transparent);
  filter: drop-shadow(0 0 18px rgba(34,243,182,0.6));
  animation: scanMove 1.35s linear infinite;
  opacity: .85;
}

@keyframes scanMove{
  0%{ top: 18%; }
  100%{ top: 82%; }
}

.scan-hud{
  position:absolute;
  left: 50%;
  top: 12%;
  transform: translateX(-50%);
  display:flex;
  align-items:center;
  gap: 12px;
  padding: 10px 14px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 999px;
  backdrop-filter: blur(14px);
  box-shadow: 0 20px 70px rgba(0,0,0,0.45);
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
}

.scan-pill{
  color:#000;
  padding: 6px 10px;
  border-radius: 999px;
  background: linear-gradient(135deg, var(--ai), var(--accent));
  font-weight: 800;
}

.scan-text{ color: rgba(232,240,255,0.9); }

.dots span{
  display:inline-block;
  animation: dot 1s infinite;
}
.dots span:nth-child(2){ animation-delay: .15s; }
.dots span:nth-child(3){ animation-delay: .3s; }
@keyframes dot{
  0%, 60%, 100%{ opacity: .2; transform: translateY(0); }
  30%{ opacity: 1; transform: translateY(-1px); }
}


/* ===== LANDING FIXES (avoid v4 .section display:none conflict) ===== */
#authSection { opacity: 1; transform: translateY(0); transition: opacity .35s ease, transform .35s ease; }
#authSection.fade-out { opacity: 0; transform: translateY(-10px); }

/* Only for landing sections inside authSection */
#authSection .section { display: block; }   /* critical */
#authSection footer { display: block; }

/* Full-bleed landing inside padded container */
.landing-root { margin: -1.75rem; } /* matches .container padding in theme */
.landing-root .hero { min-height: calc(100vh - 110px); } /* account for sticky header */

/* Glass header like Vision Lab */
.header{
  background: rgba(255,255,255,0.04) !important;
  border-bottom: 1px solid rgba(255,255,255,0.12) !important;
  box-shadow: 0 18px 70px rgba(0,0,0,0.35) !important;
  backdrop-filter: blur(14px);
}
.header h1{ letter-spacing: .2px; }


/* Collapse landing after launch to avoid empty space */
#authSection.hidden { display: none !important; }


/* Slightly reduce top whitespace (landing + app) */
#authSection .hero { padding-top: 3.4rem !important; }


/* ===== Tighter top spacing in MAIN MENU (app) ===== */
#appSection.section { padding: 0.25rem 0 0 0 !important; } /* kill huge WOW section padding */
#appSection .nav-tabs { margin-top: 0.4rem !important; }

/* Header tighter */
.header { padding: 1.1rem !important; }
.header h1 { margin: 0 !important; line-height: 1.05 !important; }


/* =========================================================
   MOBILE-FIRST (Telegram WebApp) ‚Äî FIXED
   Goal: feels native on phone, keeps 3D hero block WOW
   ========================================================= */
html { -webkit-text-size-adjust: 100%; }
body { padding-bottom: env(safe-area-inset-bottom); }
.header { padding-top: calc(1.05rem + env(safe-area-inset-top)) !important; }

/* Landing hero: allow comfortable height in TG WebView */
#authSection .hero {
  min-height: calc(100svh - 84px) !important;
  padding-left: 1.25rem !important;
  padding-right: 1.25rem !important;
}

/* App container should feel like a phone app */
.container { max-width: 680px; width: 100%; }
#appSection .card { margin-bottom: 1.1rem; }

/* --- Tablet & below: stack hero --- */
@media (max-width: 900px) {
  #authSection .hero-inner { grid-template-columns: 1fr !important; gap: 2.25rem !important; }
  #authSection .hero-text p { max-width: 100% !important; }
  #authSection .graph-wrap { width: 100%; }
  #authSection .graph svg { height: 240px !important; }
  #authSection .tag1 { top: 16% !important; left: 8% !important; }
  #authSection .tag2 { top: 52% !important; right: 8% !important; }
  #authSection .tag3 { bottom: 14% !important; left: 30% !important; }
}

/* --- Phone: tighten everything, big taps, no desktop feel --- */
@media (max-width: 520px) {
  .header { padding: 0.95rem 1rem !important; }
  .header h1 { font-size: 1.35rem !important; }
  .btn-icon { padding: 0.6rem !important; font-size: 1.25rem !important; border-radius: 12px !important; }

  .container { padding: 1.05rem !important; }
  .landing-root { margin: -1.05rem !important; }

  /* Landing */
  #authSection .hero { padding-top: 2.6rem !important; padding-bottom: 2.6rem !important; }
  #authSection .hero-text h1 { font-size: clamp(2.0rem, 9vw, 2.75rem) !important; }
  #authSection .hero-text p { font-size: 1rem !important; }
  #authSection .hero-text .btn { width: 100% !important; min-height: 48px !important; }
  #authSection .graph { padding: 1.05rem !important; border-radius: 18px !important; }
  #authSection .graph svg { height: 210px !important; }
  #authSection .ai-tag { font-size: 0.72rem !important; padding: 0.42rem 0.58rem !important; }

  /* App tabs */
  .nav-tabs { padding: 0.45rem !important; gap: 0.45rem !important; overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .nav-tabs::-webkit-scrollbar { display: none; }
  .nav-tab { flex: 0 0 auto; padding: 0.7rem 0.85rem !important; font-size: 0.9rem !important; }

  /* Cards + inputs */
  .card { padding: 1.15rem !important; border-radius: 18px !important; }
  .form-input, select { padding: 0.85rem !important; border-radius: 14px !important; font-size: 1rem !important; }
  .btn { min-height: 48px !important; }

  /* Stats grids */
  .stats-grid { grid-template-columns: 1fr !important; }
  .plan-grid { grid-template-columns: 1fr !important; }
}

/* --- Small phones --- */
@media (max-width: 380px) {
  #authSection .graph svg { height: 190px !important; }
  #authSection .ai-tag { display: none; } /* keep it clean on tiny screens */
  .nav-tab { padding: 0.65rem 0.75rem !important; font-size: 0.85rem !important; }
}



/* ===== Center specific cards' content (requested) ===== */
.step, .plan { text-align: center !important; }
.step h3, .plan h3 { margin-left: auto; margin-right: auto; }
.step p, .plan ul, .plan .price { margin-left: auto; margin-right: auto; }


/* ===== Interactive glow (hover + in-view) ===== */
.step, .plan, .card {
  position: relative;
  transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease, background .25s ease;
}

.step:hover, .plan:hover, .card:hover {
  transform: translateY(-2px);
  border-color: rgba(34,243,182,0.28) !important;
  box-shadow: 0 0 0 1px rgba(34,243,182,0.10), 0 26px 110px rgba(0,0,0,0.55), 0 0 55px rgba(34,243,182,0.18) !important;
}

.in-view {
  border-color: rgba(34,243,182,0.22) !important;
  box-shadow: 0 0 0 1px rgba(34,243,182,0.08), 0 22px 90px rgba(0,0,0,0.45), 0 0 48px rgba(34,243,182,0.14) !important;
}

</style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>üìä ChartLens</h1>
            <button class="btn-icon" onclick="logout()">üö™</button>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container">
        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading ChartLens...</p>
        </div>

        <!-- Auth Section -->
        
<section id="authSection" class="section active">

<div id="landingRoot" class="landing-root">
<section class="hero">
  <div class="hero-inner">
    <div class="hero-text">
      <h1>AI sees what<br><span>traders miss</span></h1>
      <p>ChartLens is an AI market vision system that scans chart structure, detects patterns, and reveals hidden market bias.</p>
      <div class="hero-actions">
        <button class="btn btn-primary" onclick="launchScan()">Launch AI Scan</button>
      </div>
    </div>

    <div class="graph-wrap">
      <div class="graph" id="graph">
        <svg viewBox="0 0 600 200">
          <polyline
            fill="none"
            stroke="url(#grad)"
            stroke-width="3"
            points="0,160 80,120 150,130 230,90 310,100 380,60 460,80 520,40 600,60" />
          <defs>
            <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#22f3b6"/>
              <stop offset="100%" stop-color="#36e0ff"/>
            </linearGradient>
          </defs>
        </svg>

        <div class="ai-tag tag1"><strong>AI</strong> Trend: Bullish</div>
        <div class="ai-tag tag2"><strong>AI</strong> Pattern: Breakout</div>
        <div class="ai-tag tag3"><strong>AI</strong> Confidence: 78%</div>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <h2>How AI sees the market</h2>
  <div class="steps">
    <div class="step">
      <h3>Upload chart</h3>
      <p>Provide any trading chart screenshot.</p>
    </div>
    <div class="step">
      <h3>AI scans structure</h3>
      <p>Trend, pattern, volatility zones.</p>
    </div>
    <div class="step">
      <h3>Get insight</h3>
      <p>Clear bias, signal and confidence.</p>
    </div>
  </div>
</section>


<section class="section">
  <h2>Live AI report</h2>
  <div class="steps">
    <div class="step">
      <h3>Signal</h3>
      <p><span style="color:var(--ai); font-weight:700;">BUY / SELL / HOLD</span> based on chart structure, not noise.</p>
    </div>
    <div class="step">
      <h3>Pattern</h3>
      <p>Breakouts, triangles, ranges ‚Äî marked like an analyst would.</p>
    </div>
    <div class="step">
      <h3>Confidence</h3>
      <p>Clear probability-style confidence to keep decisions rational.</p>
    </div>
  </div>
</section>
<section class="section">
  <h2>Access levels</h2>
  <div class="pricing">
    <div class="plan">
      <h3>Observer</h3>
      <div class="price">Free</div>
      <ul>
        <li>Limited scans</li>
        <li>Basic AI output</li>
      </ul>
    </div>
    <div class="plan">
      <h3>Operator</h3>
      <div class="price">$39</div>
      <ul>
        <li>Unlimited scans</li>
        <li>Full AI analysis</li>
      </ul>
    </div>
    <div class="plan">
      <h3>Vision Pro</h3>
      <div class="price">$79+</div>
      <ul>
        <li>Advanced signals</li>
        <li>Priority processing</li>
      </ul>
    </div>
  </div>
</section>

<section class="section cta">
  <h2>Ready to see the market differently?</h2>
  <button class="btn btn-primary" onclick="launchScan()">Start Free Scan</button>
</section>

<footer>
  ChartLens ¬© AI Market Vision
</footer>
</div>

</section>
  </div>
</section>


        <!-- App Sections -->
        <section id="appSection" class="section">
            <!-- Navigation -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('analyze')">üìà Analyze</button>
                <button class="nav-tab" onclick="switchTab('history')">üìú History</button>
                <button class="nav-tab" onclick="switchTab('referral')">üéÅ Referral</button>
                <button class="nav-tab" onclick="switchTab('profile')">üë§ Profile</button>
            </div>

            <!-- ANALYZE TAB -->
            <div id="analyze-tab" class="tab-content active">
                <!-- User Info -->
                <div class="user-info">
                    <div>
                        <h3 id="userName">Trader</h3>
                        <span id="userPlan" class="badge">FREE PLAN</span>
                    </div>
                    <div class="quota">
                        <small>Daily Quota</small>
                        <div style="margin-top: 0.25rem;">
                            <strong><span id="analysisCount">0</span>/<span id="analysisLimit">5</span></strong>
                        </div>
                    </div>
                </div>

                <!-- Analysis Input Card -->
                <div class="card">
                    <h3>üîó Enter Chart Data</h3>
                    <div class="form-group">
                        <label>Chart Image</label>
<input type="file" id="imageFile" accept="image/*" class="form-input" />
<div id="imagePreview" style="display:none; margin-top:1rem;">
    <img id="previewImg" style="max-width:100%; border-radius:12px; border:2px solid #2dd4bf;" />
</div>
                    </div>
                    <div class="form-group">
                        <label for="symbol">Crypto Symbol</label>
                        <select id="symbol" style="margin-bottom: 0;">
                            <option value="BTCUSDT">‚Çø BTC/USDT</option>
                            <option value="ETHUSDT">Œû ETH/USDT</option>
                            <option value="BNBUSDT">BNB/USDT</option>
                            <option value="SOLUSDT">SOL/USDT</option>
                            <option value="ADAUSDT">ADA/USDT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="timeframe">Timeframe</label>
                        <select id="timeframe">
                            <option value="1m">1m</option>
                            <option value="5m">5m</option>
                            <option value="15m">15m</option>
                            <option value="1h" selected>1h</option>
                            <option value="4h">4h</option>
                            <option value="1d">1d</option>
                            <option value="1w">1w</option>
                        </select>
                    </div>
                    <button id="btnAnalyze" class="btn btn-primary btn-full" onclick="handleAnalyze()">
                        üîç Analyze Chart
                    </button>
                </div>

                <!-- Analysis Result Card -->
                <div id="resultCard" class="card hidden">
                    <h3>üìä AI Analysis Result</h3>
                    
                    <div class="signal-badge">
                        <span id="signalText" class="signal">--</span>
                    </div>

                    <div class="result-section">
                        <h4>üìâ Chart Pattern</h4>
                        <p id="chartDescription" class="result-text">Loading...</p>
                    </div>

                    <div class="result-section">
                        <h4>üéØ Market Insight</h4>
                        <p id="marketInsights" class="result-text">Loading...</p>
                    </div>

                    <div class="confidence">
                        <div><strong>AI Confidence</strong></div>
                        <div class="confidence-bar">
                            <div id="confidenceFill" class="confidence-fill" style="width: 0%;"></div>
                        </div>
                        <div style="margin-top: 0.5rem;">
                            <strong id="confidence">0</strong>%
                        </div>
                    </div>

                    <button class="btn btn-secondary btn-full" onclick="startNewAnalysis()">
                        ‚Üê New Analysis
                    </button>
                </div>

                <!-- Error Message -->
                <div id="errorCard" class="card error-card hidden">
                    <h4>‚ö†Ô∏è Error</h4>
                    <p id="errorMessage">An error occurred</p>
                    <button class="btn btn-secondary btn-full" onclick="dismissError()">Dismiss</button>
                </div>

                <!-- Premium Card -->
                <div class="card premium-card">
                    <h3>üíé Premium Plans</h3>
                    <p>Unlock unlimited analysis power</p>
                    <div class="plan-grid">
                        <div class="plan">
                            <h4>üî∑ Lite</h4>
                            <div class="price">$9.99/mo</div>
                            <ul>
                                <li>‚úÖ 100 analyses/day</li>
                                <li>‚úÖ Basic signals</li>
                                <li>‚úÖ Support</li>
                            </ul>
                            <button class="btn btn-secondary" onclick="upgradePlan('lite')">
                                Upgrade
                            </button>
                        </div>
                        <div class="plan">
                            <h4>üí† Pro</h4>
                            <div class="price">$29.99/mo</div>
                            <ul>
                                <li>‚úÖ Unlimited</li>
                                <li>‚úÖ Advanced signals</li>
                                <li>‚úÖ Priority support</li>
                            </ul>
                            <button class="btn btn-primary" onclick="upgradePlan('pro')">
                                Upgrade
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HISTORY TAB -->
            <div id="history-tab" class="tab-content hidden">
                <div class="card">
                    <h3>üìú Analysis History</h3>
                    <div id="historyList" class="history-list">
                        <p class="text-muted" style="padding: 1rem; text-align: center;">No analyses yet</p>
                    </div>
                </div>
            </div>

            <!-- REFERRAL TAB -->
            <div id="referral-tab" class="tab-content hidden">
                <div class="card">
                    <h3>üéÅ Referral Program</h3>
                    <p>Share your link and earn rewards for each friend who joins</p>
                </div>

                <div class="referral-box">
                    <h4>Your Referral Link</h4>
                    <div class="referral-code" id="referralCode">CHARTLENS_CRYPTO_ABC123XYZ</div>
                    <button class="copy-btn" onclick="copyReferralCode()">üìã Copy Link</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">0</div>
                        <div class="stat-label">Referrals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">$0.00</div>
                        <div class="stat-label">Earned</div>
                    </div>
                </div>

                <div class="card">
                    <h3>üí∞ How it works</h3>
                    <p style="font-size: 0.9rem;">
                        <strong>‚úÖ Share your link</strong> - Send to crypto friends<br/>
                        <strong>‚úÖ They sign up</strong> - Using your referral code<br/>
                        <strong>‚úÖ You earn 20%</strong> - Of their first payment<br/>
                        <strong>‚úÖ Unlimited income</strong> - No cap on earnings
                    </p>
                </div>
            </div>

            <!-- PROFILE TAB -->
            <div id="profile-tab" class="tab-content hidden">
                <div class="card">
                    <h3>üë§ Your Profile</h3>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalAnalyses">0</div>
                        <div class="stat-label">Total Analyses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="userAccuracy">--</div>
                        <div class="stat-label">Signal Accuracy</div>
                    </div>
                </div>

                <div class="card">
                    <h4>Personal Information</h4>
                    <div style="margin-bottom: 1rem;">
                        <label style="color: var(--color-text-muted); font-size: 0.85rem;">Username</label>
                        <div style="font-weight: 600; margin-top: 0.25rem;" id="profileName">Crypto Trader</div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="color: var(--color-text-muted); font-size: 0.85rem;">Current Plan</label>
                        <div style="font-weight: 600; margin-top: 0.25rem;" id="profilePlan">Free Plan</div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="color: var(--color-text-muted); font-size: 0.85rem;">Member Since</label>
                        <div style="font-weight: 600; margin-top: 0.25rem;" id="profileDate">Today</div>
                    </div>
                </div>

                <div class="card">
                    <h4>Account Stats</h4>
                    <div style="margin-bottom: 0.75rem;">
                        <span style="color: var(--color-text-muted);">Today Analyses</span>
                        <div style="margin-top: 0.25rem; color: var(--color-primary); font-weight: 600;">
                            <span id="profileAnalysesCount">0</span>/5
                        </div>
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <span style="color: var(--color-text-muted);">Account Status</span>
                        <div style="margin-top: 0.25rem;">
                            <span class="badge">ACTIVE</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>üîê ChartLens - Blockchain Intelligence Platform</p>
        <p style="margin-top: 0.5rem; font-size: 0.75rem;">¬© 2024 ChartLens. Not financial advice.</p>
    </footer>

    <script>
      // Global user_id for backend requests
      window.APP_USER_ID = null;

      (function(){
        const tg = window.Telegram && window.Telegram.WebApp;
        try {
          if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
            window.APP_USER_ID = tg.initDataUnsafe.user.id;
          }
        } catch (e) {
          window.APP_USER_ID = null;
        }
      })();
    </script>


    <script>
        let appState = {
            isAuthenticated: false,
            userId: 1,
            userProfile: null,
            currentAnalysis: null,
            analyses: [],
            currentTab: 'analyze'
        };

        const mockAnalyses = [
            {
                id: 1,
                symbol: 'BTCUSDT',
                timeframe: '1h',
                chartDescription: 'BTC is trading in a strong uptrend with consistent higher highs and higher lows. The price has broken above key resistance at $65,000. Volume surge on bullish candles indicates institutional accumulation. Support identified at $63,500.',
                ai_signal: 'BUY',
                market_insights: 'Bitcoin showing strong momentum above 50-day MA. RSI at 68 (strength not overbought). Altcoins following. Watch resistance at $67,500.',
                confidence_score: 0.82,
                created_at: new Date(Date.now() - 3600000).toISOString()
            },
            {
                id: 2,
                symbol: 'ETHUSDT',
                timeframe: '4h',
                chartDescription: 'Ethereum consolidating after recent rally. Price bouncing $3,200-$3,300. Lower timeframe shows breakout potential above resistance. Volume moderate. MACD positive divergence detected.',
                ai_signal: 'HOLD',
                market_insights: 'ETH consolidating before move. Confirmation needed above $3,300. Fed decision impact expected. Staking yields remain attractive.',
                confidence_score: 0.65,
                created_at: new Date(Date.now() - 7200000).toISOString()
            },
            {
                id: 3,
                symbol: 'BNBUSDT',
                timeframe: '1d',
                chartDescription: 'BNB showing weakness: lower highs and lower lows. Broken below 200-day MA. Volume declining on down moves. Potential capitulation phase. Support at $580.',
                ai_signal: 'SELL',
                market_insights: 'BNB underperforming peers. Sector rotation risk. Watch volume spike for confirmation. Wait for retrace before entry.',
                confidence_score: 0.73,
                created_at: new Date(Date.now() - 86400000).toISOString()
            }
        ];

        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 1000);
        });

        function authenticateUser() {
            setTimeout(() => {
                appState.isAuthenticated = true;
                appState.userProfile = {
                    first_name: 'Trader',
                    plan: 'free',
                    daily_analysis_count: 1,
                    daily_analysis_limit: 5,
                    created_at: new Date().toISOString()
                };
                appState.analyses = mockAnalyses.slice();
                
                document.getElementById('authSection').classList.remove('active');
                document.getElementById('appSection').classList.add('active');
                updateUserInfo();
            }, 800);
        }

        function logout() {
            appState.isAuthenticated = false;
            const auth = document.getElementById('authSection');
            if (auth) { auth.classList.remove('hidden'); auth.classList.remove('fade-out'); }
            document.getElementById('authSection').classList.add('active');
            document.getElementById('appSection').classList.remove('active');
            setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 50);
        }

        function updateUserInfo() {
            const profile = appState.userProfile;
            if (!profile) return;
            document.getElementById('userName').textContent = profile.first_name || 'Trader';
            document.getElementById('userPlan').textContent = profile.plan.toUpperCase() + ' PLAN';
            document.getElementById('analysisCount').textContent = profile.daily_analysis_count;
            document.getElementById('analysisLimit').textContent = profile.daily_analysis_limit;
            document.getElementById('profileName').textContent = profile.first_name;
            document.getElementById('profilePlan').textContent = (profile.plan.charAt(0).toUpperCase() + profile.plan.slice(1)) + ' Plan';
            document.getElementById('profileAnalysesCount').textContent = profile.daily_analysis_count;
            document.getElementById('profileDate').textContent = new Date(profile.created_at).toLocaleDateString();
            document.getElementById('totalAnalyses').textContent = appState.analyses.length;
            loadAnalysisHistory();
        }

        function switchTab(tabName) {
            appState.currentTab = tabName;
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tabName + '-tab').classList.remove('hidden');
        }

        function setScan(on){
  const el = document.getElementById('scanOverlay');
  if(!el) return;
  if(on) el.classList.add('active'); else el.classList.remove('active');
}


function handleAnalyze() {
            const imageBase64 = (typeof uploadedImageBase64 !== 'undefined') ? uploadedImageBase64 : null;
            const symbol = document.getElementById('symbol').value;
            const timeframe = document.getElementById('timeframe').value;

            if (!imageBase64) { showError('Please upload chart image'); return; }

            if (appState.userProfile.daily_analysis_count >= appState.userProfile.daily_analysis_limit) {
                showError('Daily limit reached. Upgrade to Pro for unlimited analyses!');
                return;
            }

            analyzeChart(imageBase64, symbol, timeframe);
        }

        function analyzeChart(imageUrl, symbol, timeframe) {
            if (!window.APP_USER_ID) {
      showError("Open this page from Telegram");
      return;
    }
            const btnAnalyze = document.getElementById('btnAnalyze');
            btnAnalyze.disabled = true;
            btnAnalyze.textContent = '‚è≥ Analyzing...';
            setScan(true);

            setTimeout(() => {
                const signal = ['BUY', 'SELL', 'HOLD'][Math.floor(Math.random() * 3)];
                const confidence = 0.65 + Math.random() * 0.3;

                const descriptions = {
                    'BUY': [
                        `${symbol} showing strong bullish momentum with higher highs/lows. Price broken above key resistance. Volume surging on bullish candles. Support at key moving average.`,
                        `Uptrend confirmed on ${symbol}. Higher lows with pullbacks. Accumulation pattern visible. RSI near overbought but not extreme.`
                    ],
                    'SELL': [
                        `${symbol} showing weakness: lower highs/lows. Broken below key support. Volume declining on down moves. Further downside potential.`,
                        `Bearish structure on ${symbol}. Failed above resistance. Heavy volume on downside. Support next level to watch.`
                    ],
                    'HOLD': [
                        `${symbol} consolidating in tight range. Bouncing support/resistance. Volume declining. Breakout confirmation needed.`,
                        `${symbol} range consolidation. Key level touches. Volume insufficient for directional move. Patience required.`
                    ]
                };

                const insights = {
                    'BTCUSDT': 'Bitcoin: Institutional adoption continues. Spot ETF flows positive. Macro improving. Fed decision watch.',
                    'ETHUSDT': 'Ethereum: DeFi growth strong. Layer 2 adoption accelerating. Staking yields attractive.',
                    'BNBUSDT': 'BNB: BSC metrics solid. Governance updates positive. Regulatory clarity needed.',
                    'SOLUSDT': 'SOL: Ecosystem recovery on track. Dev activity increasing. Network stability improving.',
                    'ADAUSDT': 'ADA: Smart contracts active. Defi building. Cardano adoption growing.'
                };

                const analysis = {
                    id: appState.analyses.length + 1,
                    symbol: symbol,
                    timeframe: timeframe,
                    image_url: imageUrl,
                    chartDescription: descriptions[signal][Math.floor(Math.random() * descriptions[signal].length)],
                    ai_signal: signal,
                    market_insights: insights[symbol] || 'Crypto market dynamic. Watch major support/resistance levels.',
                    confidence_score: confidence,
                    created_at: new Date().toISOString()
                };

                appState.currentAnalysis = analysis;
                appState.analyses.unshift(analysis);
                appState.userProfile.daily_analysis_count++;

                displayAnalysisResult(analysis);
                updateUserInfo();

                setScan(false);

                btnAnalyze.disabled = false;
                btnAnalyze.textContent = 'üîç Analyze Chart';
            }, 2500);
        }

        function displayAnalysisResult(analysis) {
            const signalText = document.getElementById('signalText');
            signalText.textContent = analysis.ai_signal;
            signalText.className = 'signal ' + analysis.ai_signal.toLowerCase();
            document.getElementById('chartDescription').textContent = analysis.chartDescription;
            document.getElementById('marketInsights').textContent = analysis.market_insights;
            const confidence = Math.round(analysis.confidence_score * 100);
            document.getElementById('confidence').textContent = confidence;
            document.getElementById('confidenceFill').style.width = confidence + '%';
            document.getElementById('resultCard').classList.remove('hidden');
            document.getElementById('resultCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function startNewAnalysis() {
            document.getElementById('resultCard').classList.add('hidden');

            // reset upload + preview
            const fileInput = document.getElementById('imageFile');
            if (fileInput) fileInput.value = '';

            if (typeof uploadedImageBase64 !== 'undefined') uploadedImageBase64 = null;

            const pv = document.getElementById('imagePreview');
            if (pv) pv.style.display = 'none';

            const img = document.getElementById('previewImg');
            if (img) img.src = '';

            // focus on symbol for quick next run
            const sym = document.getElementById('symbol');
            if (sym) sym.focus();
        }

        function loadAnalysisHistory() {
            const historyList = document.getElementById('historyList');
            if (appState.analyses.length === 0) {
                historyList.innerHTML = '<p class="text-muted" style="padding: 1rem; text-align: center;">No analyses yet</p>';
                return;
            }
            historyList.innerHTML = appState.analyses.map((a, idx) => `
                <div class="history-item" onclick="selectAnalysis(${idx})">
                    <div>
                        <div class="history-symbol">${a.symbol}</div>
                        <div class="history-date">${formatDate(a.created_at)} ‚Ä¢ ${a.timeframe}</div>
                    </div>
                    <span class="history-signal ${a.ai_signal.toLowerCase()}">
                        ${a.ai_signal}
                    </span>
                </div>
            `).join('');
        }

        function selectAnalysis(index) {
            appState.currentAnalysis = appState.analyses[index];
            displayAnalysisResult(appState.currentAnalysis);
            switchTab('analyze');
            document.querySelector('[onclick="switchTab(\'analyze\')"]').click();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            if (diffMinutes < 60) return `${diffMinutes}m ago`;
            else if (diffHours < 24) return `${diffHours}h ago`;
            else return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function copyReferralCode() {
            const code = document.getElementById('referralCode').innerText;
            navigator.clipboard.writeText(code).then(() => {
                const btn = event.target;
                btn.classList.add('copied');
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.textContent = 'üìã Copy Link';
                }, 2000);
            });
        }

        function upgradePlan(plan) {
            alert(`üí≥ ${plan.toUpperCase()} Plan\n\n${plan === 'lite' ? '$9.99/month\n100 analyses/day' : '$29.99/month\nUnlimited analyses'}\n\nPayment coming soon!`);
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorCard').classList.remove('hidden');
            document.getElementById('errorCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function dismissError() {
            document.getElementById('errorCard').classList.add('hidden');
        }
        // === WOW -> App bridge
        function launchScan() {
            // Cinematic transition: fade landing + show scan overlay
            const auth = document.getElementById('authSection');
            if (auth) { auth.classList.add('fade-out'); setTimeout(()=>auth.classList.add('hidden'), 550); }
            if (typeof setScan === 'function') setScan(true);

            authenticateUser();

            // When app becomes active, jump to top/app
            setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'instant' });
                const app = document.getElementById('appSection');
                if (app) app.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 920);

            // hide overlay after transition
            setTimeout(() => {
                if (typeof setScan === 'function') setScan(false);
            }, 1400);
        }

        // Make the hero graph tilt work (WOW uses id="graph")
        (function() {
            const graph = document.getElementById("graph");
            if (!graph) return;
            document.addEventListener("mousemove", (e) => {
                const x = (window.innerWidth / 2 - e.clientX) / 40;
                const y = (window.innerHeight / 2 - e.clientY) / 40;
                graph.style.transform = `rotateY(calc(var(--scrollRy) + ${x}deg)) rotateX(calc(var(--scrollRx) + ${y}deg))`;
            });
        })();

</script>

<script>
let uploadedImageBase64 = null;

document.addEventListener("DOMContentLoaded", () => {
    const fileInput = document.getElementById("imageFile");
    if (!fileInput) return;

    fileInput.addEventListener("change", function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            uploadedImageBase64 = event.target.result;
            document.getElementById("previewImg").src = uploadedImageBase64;
            document.getElementById("imagePreview").style.display = "block";
        };
        reader.readAsDataURL(file);
    });
});
</script>


    <!-- ===== AI SCAN OVERLAY (VISUAL ONLY) ===== -->
    <div id="scanOverlay" class="scan-overlay" aria-hidden="true">
        <div class="scan-noise"></div>
        <div class="scan-grid"></div>
        <div class="scan-line"></div>
        <div class="scan-hud">
            <div class="scan-pill">AI VISION</div>
            <div class="scan-text">
                Scanning market structure<span class="dots"><span>.</span><span>.</span><span>.</span></span>
            </div>
        </div>
    </div>


<script>
(function(){
  const g = document.getElementById('graph');
  if (!g) return;

  // add touch tilt for phones
  let raf = 0, nx = 0.5, ny = 0.5;
  const clamp01 = (v)=>Math.max(0, Math.min(1, v));

  function apply(){
    raf = 0;
    const ry = (0.5 - nx) * 12;  // rotateY
    const rx = (ny - 0.5) * 10;  // rotateX
    g.style.transform = `rotateY(calc(var(--scrollRy) + ${ry}deg)) rotateX(calc(var(--scrollRx) + ${rx}deg))`;
  }

  function onPoint(x, y){
    const r = g.getBoundingClientRect();
    nx = clamp01((x - r.left) / Math.max(1, r.width));
    ny = clamp01((y - r.top) / Math.max(1, r.height));
    if (!raf) raf = requestAnimationFrame(apply);
  }

  g.addEventListener('touchmove', (e)=>{
    const t = e.touches && e.touches[0];
    if (!t) return;
    onPoint(t.clientX, t.clientY);
  }, { passive: true });

  g.addEventListener('touchend', ()=>{
    g.style.transform = 'rotateY(0deg) rotateX(0deg)';
  }, { passive: true });

  // Telegram WebApp: expand if available (safe no-op in browser)
  const tg = window.Telegram && window.Telegram.WebApp;
  if (tg) { try { tg.ready(); tg.expand(); } catch(e){} }
})();
</script>



<script>
(function(){
  // === Glow blocks when they enter viewport ===
  const targets = Array.from(document.querySelectorAll('.step, .plan, .card'));
  if ('IntersectionObserver' in window && targets.length) {
    const io = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) e.target.classList.add('in-view');
        else e.target.classList.remove('in-view');
      });
    }, { threshold: 0.25 });
    targets.forEach(t => io.observe(t));
  }

  // === Scroll-driven 3D motion for HERO graph ===
  const g = document.getElementById('graph');
  if (!g) return;

  // We'll blend pointer tilt (already exists) with a scroll wobble.
  // Scroll wobble is subtle: keeps "classy", not carnival.
  let scrollRaf = 0;
  let baseRx = 0, baseRy = 0;

  function computeBase(){
    const y = window.scrollY || document.documentElement.scrollTop || 0;
    // Normalize to a smooth periodic motion
    baseRy = Math.sin(y * 0.006) * 6;  // left-right
    baseRx = Math.cos(y * 0.005) * 4;  // up-down
  }

  function applyBase(){
    scrollRaf = 0;
    computeBase();
    // If mouse/touch tilt also sets transform, we still want scroll to matter.
    // We'll store base as CSS variables and let the existing handler write rotations additively if present.
    g.style.setProperty('--scrollRy', baseRy.toFixed(2) + 'deg');
    g.style.setProperty('--scrollRx', baseRx.toFixed(2) + 'deg');
  }

  function onScroll(){
    if (!scrollRaf) scrollRaf = requestAnimationFrame(applyBase);
  }

  window.addEventListener('scroll', onScroll, { passive: true });
  applyBase();

  // Patch: make current transform include scroll rotation even when pointer handler runs.
  // We wrap the existing pointer transform by listening and reapplying with scroll vars.
  // If another script sets g.style.transform, we can't intercept it, so we set a CSS rule fallback below.
})();
</script>
<script>
async function analyzeChart(imageBase64, symbol, timeframe) {
    const btnAnalyze = document.getElementById('btnAnalyze');
    btnAnalyze.disabled = true;
    btnAnalyze.textContent = '‚è≥ Analyzing...';
    setScan(true);

    try {
        // --- normalize base64 (CRITICAL for iOS / Safari)
        if (!imageBase64.startsWith("data:image")) {
            imageBase64 = "data:image/png;base64," + imageBase64;
        }

        imageBase64 = imageBase64.replace(
            /^data:image\/(heic|heif);base64,/i,
            "data:image/jpeg;base64,"
        );

        const response = await fetch(
            "https://ai-signals-backend.onrender.com/analyze",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                  user_id: window.APP_USER_ID, // üî• –ö–õ–Æ–ß–ï–í–û
                  image: imageBase64,
                  symbol: symbol,
                  timeframe: timeframe
                })
            }
        );

        if (!response.ok) {
            const text = await response.text();
            throw new Error(text || "Server error");
        }

        const data = await response.json();

        const analysis = {
            id: Date.now(),
            symbol,
            timeframe,
            chartDescription: data.chartDescription,
            ai_signal: data.ai_signal,
            market_insights: data.market_insights,
            confidence_score: data.confidence_score,
            created_at: new Date().toISOString()
        };

        appState.currentAnalysis = analysis;
        appState.analyses.unshift(analysis);
        appState.userProfile.daily_analysis_count++;

        displayAnalysisResult(analysis);
        updateUserInfo();

    } catch (e) {
        showError(e.message);
    } finally {
        setScan(false);
        btnAnalyze.disabled = false;
        btnAnalyze.textContent = 'üîç Analyze Chart';
    }
}
</script>


<style>
/* Blend scroll rotation into the graph transform using CSS vars */
#graph {
  --scrollRx: 0deg;
  --scrollRy: 0deg;
  transform: rotateY(var(--scrollRy)) rotateX(var(--scrollRx));
}
</style>

</body>
</html>
